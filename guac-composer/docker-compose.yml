version: '3'

services:
   guacd:
    container_name: guacd       
    image: guacamole/guacd
    restart: unless-stopped
    networks:
      - guac 
   guacamole: 
    container_name: guacamole
    image: guacamole/guacamole:0.9.14
    restart: unless-stopped
    networks:
      - guac
      - proxy
    ports:
      - 8080
    environment:
      GUACD_HOSTNAME: guacd
      MYSQL_HOSTNAME: guac-mysql
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      LDAP_HOSTNAME: 10.10.0.4
      LDAP_PORT: 389
      LDAP_USER_BASE_DN: OU=XTUsers,DC=ITXTVTest,DC=internal
      LDAP_CONFIG_BASE_DN: CN=Users,DC=ITXTVTest,DC=internal
      LDAP_SEARCH_BIND_DN: CN=SA.Guacamole,OU=ServiceAccounts,DC=ITXTVTest,DC=internal
      LDAP_USERNAME_ATTRIBUTE: sAMAccountName
      LDAP_SEARCH_BIND_PASSWORD: Cbr600rr!
    labels:
      - "traefik.backend=guacamole"
      - "traefik.docker.network=proxy"
      - "traefik.frontend.rule=Host:guacamole.octotrading.it"
      - "traefik.enable=true"
      - "traefik.port=8080"
      - "traefik.default.protocol=http"

networks:
   guac:
     driver: bridge
   proxy:
      external: true
